function res = chargeNegGS(n, Q, K, l12, l23, l13, w, nuc)
    order2 = 0;
    order2Shift = [0, 1, -1];
    for i = 1:3
        for j = 1:3
            for k = 1:3
                if i ~= j && i ~=k && k ~= j
                    order2 = order2 + ...
                        sndOrderIntegral(2 * K / n * log(nuc * l12), 2 * K / n * log(nuc * l23), 2 * K / n * log(nuc * l13),...
                                         order2Shift(i), order2Shift(j), order2Shift(k), Q);
                end
            end
        end
    end
    res = fstOrderIntegral(2 * K / n .*  log(nuc^3 .* l12.^2 * l23.^2 ./ (l13)), Q) + w.*order2;
end

function res = fstOrderIntegral(s, Q)
    % Integrate[Exp[-s alpha^2], {alpha, -1/2, 1/2}]
    % Notice alpha/2 pi -> alpha
    % s = 2 K /n log(l_12^2 l_23^2 / (l1+l2))
    res = (sqrt(-1)*(1/2)).*exp(1).^((-1).*pi.^2.*Q.^2.*s.^(-1)).*pi.^(1/2) ...
          .*s.^(-1/2).*(erfi((pi.*Q+(sqrt(-1)*(-1/2)).*s).*s.^(-1/2))+(-1).* ...
          erfi((pi.*Q+(sqrt(-1)*(1/2)).*s).*s.^(-1/2)));
end

function res = sndOrderIntegral(s12, s23, s13, a1, a2, a3, Q)
    % Integrate[Exp[-2 I Pi alpha Q]Exp[s12 (alpha + a1)(-2 alpha + a2) + s23 (-2alpha + a2)(alpha + a3) + s13 (alpha + a1)(alpha + a3)],
    % {alpha, 1/2, -1/2}]
    % Notice alpha/2 pi -> alpha
    % a_i \in {1, 0, -1}
    % s_ij = 2 K / n log(l_ij)
    res = (-1/2).*exp(1).^((8.*s12+(-4).*s13+8.*s23).^(-1).*((-4).*pi.^2.* ...
          Q.^2+a2.^2.*s12.^2+2.*a2.*a3.*s12.*s13+a3.^2.*s13.^2+a1.^2.*((-2) ...
          .*s12+s13).^2+2.*a2.^2.*s12.*s23+4.*a2.*a3.*s12.*s23+(-2).*a2.* ...
          a3.*s13.*s23+(-4).*a3.^2.*s13.*s23+a2.^2.*s23.^2+4.*a2.*a3.* ...
          s23.^2+4.*a3.^2.*s23.^2+(sqrt(-1)*4).*pi.*Q.*(a1.*(2.*s12+(-1).* ...
          s13)+(-1).*a3.*(s13+(-2).*s23)+(-1).*a2.*(s12+s23))+2.*a1.*((-1).* ...
          a3.*s13.*(s13+(-2).*s23)+2.*a3.*s12.*(s13+2.*s23)+a2.*(2.*s12.^2+( ...
          -1).*s12.*s13+2.*s12.*s23+s13.*s23)))).*pi.^(1/2).*(2.*s12+(-1).* ...
          s13+2.*s23).^(-1/2).*(erfi(1i .* ((1/2).*(2.*s12+(-1).*s13+2.*s23).^(-1/2) ...
          .*((sqrt(-1)*2).*pi.*Q+((-2)+2.*a1+(-1).*a2).*s12+s13+(-1).*a1.* ...
          s13+(-1).*a3.*s13+(-2).*s23+(-1).*a2.*s23+2.*a3.*s23)))./1i+(-1).*erfi(1i.*(( ...
          1/2).*(2.*s12+(-1).*s13+2.*s23).^(-1/2).*((sqrt(-1)*2).*pi.*Q+(2+ ...
          2.*a1+(-1).*a2).*s12+(-1).*s13+(-1).*a1.*s13+(-1).*a3.*s13+2.*s23+ ...
          (-1).*a2.*s23+2.*a3.*s23)))./1i);

end